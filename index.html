<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<meta name="color-scheme" content="light dark"/>
<meta name="description" content="Appli de L√©na ‚Äî activit√©s ludiques (lecture, maths, logique, arts) avec √©toiles, pi√®ces et effets magiques pour enfants."/>
<title>Appli de L√©na ‚Äî Menu magique ü¶Ñ</title>
<meta name="theme-color" content="#b06fff"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@600;700;900&family=Nunito:wght@600;800&display=swap" rel="stylesheet">
<style>
/* Estilos CSS del juego
  Mejoras de la paleta de colores, tipograf√≠a, y animaciones.
  Secci√≥n 'Memory Game' a√±adida.
*/

:root {
  /* Paleta de colores m√°s vibrante y pastel */
  --bg: #fdf6e3;
  --bg2: #fae6b8;
  --card: rgba(255, 255, 255, .95);
  --cardHi: rgba(255, 255, 255, .9);
  --ink: #4a4a4a;
  --muted: #8c8c8c;
  --primary: #9466ff;
  --primary-light: #b06fff;
  --success: #66bb6a;
  --warning: #ffb74d;
  --danger: #ef5350;
  --highlight: #ffee58;
  /* Espaciado y tipograf√≠a */
  --space-unit: 1rem;
  --font-heading: 'Fredoka', sans-serif;
  --font-body: 'Nunito', sans-serif;
  --font-size-base: 1rem;
  --font-size-large: 1.5rem;
  --font-size-xl: 2rem;
  --font-size-xxl: 3rem;
  /* Sombra y bordes */
  --shadow-small: 0 4px 6px rgba(0, 0, 0, 0.1);
  --shadow-medium: 0 10px 15px rgba(0, 0, 0, 0.15);
  --shadow-large: 0 20px 25px rgba(0, 0, 0, 0.2);
  --border-radius-large: 1.5rem;
  --border-radius-medium: 1rem;
}

* { box-sizing: border-box; }
body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--ink);
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  padding: var(--space-unit);
  line-height: 1.6;
  font-size: var(--font-size-base);
  transition: background-color 0.5s ease-in-out;
}

/* Fondos de pantalla por nivel */
.body-level-1 { background-color: #fce4ec; }
.body-level-2 { background-color: #e3f2fd; }
.body-level-3 { background-color: #e8f5e9; }
.body-level-4 { background-color: #fff3e0; }
.body-level-5 { background-color: #f3e5f5; }
.body-level-6 { background-color: #e0f2f1; }
.body-level-7 { background-color: #f1f8e9; }
.body-level-8 { background-color: #e1f5fe; }
.body-level-9 { background-color: #fffde7; }
.body-level-10 { background-color: #efebe9; }
.body-level-11 { background-color: #fce4ec; }
.body-level-12 { background-color: #e3f2fd; }


#stageTop {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  max-width: 800px;
  padding: var(--space-unit);
  font-family: var(--font-heading);
  font-size: var(--font-size-large);
  color: var(--primary);
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
  flex-wrap: wrap;
  gap: 1rem;
}

#stageTop .scores-container {
  display: flex;
  justify-content: space-between;
  width: 100%;
}

#stageTop span {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.25rem 0.75rem;
  border-radius: 9999px;
  background: var(--card);
  box-shadow: var(--shadow-small);
}

#stageTop span::before {
  content: '‚≠êÔ∏è';
  font-size: 1.25em;
}

#stageTop span.coins::before {
  content: 'üí∞';
}

#stageTop span.level::before {
  content: 'üöÄ';
}

/* Estilos mejorados para los botones de temas */
.topic-btn {
  font-family: var(--font-heading);
  padding: 1rem 1.5rem;
  border-radius: 1.5rem;
  border: none;
  background: var(--bg2);
  color: var(--primary);
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  box-shadow: var(--shadow-small);
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  gap: 0.5rem;
  font-size: var(--font-size-large);
  animation: bounceIn 0.5s ease-out;
}
.topic-btn:hover {
  transform: scale(1.05);
  box-shadow: var(--shadow-medium);
  background: var(--primary-light);
  color: white;
}
.topic-btn:active {
  transform: scale(0.95);
  box-shadow: var(--shadow-small);
}

#btnBack {
  background: var(--muted);
  color: white;
  margin-top: 1rem;
  box-shadow: var(--shadow-small);
  transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}
#btnBack:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-medium);
}
#btnBack:active {
  transform: scale(0.95);
}

#stageBottom {
  width: 100%;
  max-width: 800px;
  background: var(--card);
  border-radius: var(--border-radius-large);
  padding: calc(var(--space-unit) * 2);
  box-shadow: var(--shadow-large);
  text-align: center;
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  gap: var(--space-unit);
  animation: fadeIn 1s ease-in-out;
}

#stageBottom::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, var(--p1) 0%, transparent 70%);
  opacity: 0.1;
  animation: bg-pulse 10s infinite alternate;
}

@keyframes bg-pulse {
  from { transform: scale(1); }
  to { transform: scale(1.1); }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

#content {
  position: relative;
  z-index: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-unit);
}

.question-prompt {
  font-family: var(--font-heading);
  font-size: var(--font-size-xl);
  color: var(--ink);
  margin-bottom: var(--space-unit);
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
  animation: fadeIn 0.8s ease-in-out;
}

.options-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-unit);
  width: 100%;
}

.option {
  font-family: var(--font-body);
  font-size: var(--font-size-large);
  padding: var(--space-unit);
  border-radius: var(--border-radius-medium);
  background: var(--bg2);
  border: 3px solid transparent;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  box-shadow: var(--shadow-small);
  text-align: center;
  animation: bounceIn 0.5s ease-out;
}

.option:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-medium);
  border-color: var(--primary-light);
}
.option:active {
  transform: scale(0.95);
}

.option.selected {
  transform: scale(1.05);
  border-color: var(--primary);
  background: var(--primary);
  color: white;
  box-shadow: var(--shadow-medium);
}

.option.correct {
  transform: scale(1.1);
  background: var(--success);
  border-color: var(--success);
  color: white;
  animation: pop 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55) both;
}

.option.wrong {
  transform: scale(0.95);
  background: var(--danger);
  border-color: var(--danger);
  color: white;
  animation: shake 0.5s cubic-bezier(.36, .07, .19, .97) both;
}

.prompt {
  font-family: var(--font-heading);
  font-size: var(--font-size-large);
  margin-top: var(--space-unit);
  padding: 0.5rem 1rem;
  border-radius: 1rem;
  width: fit-content;
  align-self: center;
  animation: fadeIn 0.5s ease-in-out;
}

.prompt.ok {
  background-color: var(--success);
  color: white;
}

.prompt.bad {
  background-color: var(--danger);
  color: white;
}

#stageBtns {
  display: flex;
  justify-content: center;
  gap: var(--space-unit);
  margin-top: calc(var(--space-unit) * 2);
  width: 100%;
}

.btn {
  font-family: var(--font-heading);
  font-size: var(--font-size-large);
  padding: 0.75rem 2rem;
  border-radius: var(--border-radius-medium);
  border: none;
  cursor: pointer;
  box-shadow: var(--shadow-small);
  transition: all 0.2s ease-in-out;
  flex-grow: 1;
  max-width: 200px;
}

.btn:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-medium);
}
.btn:active {
  transform: scale(0.95);
}

#btnPrev {
  background: var(--muted);
  color: white;
}

#btnSkip {
  background: var(--primary-light);
  color: white;
}

/* Animaciones y efectos */
.fx-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
.fx-pop { animation: pop 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55) both; }
.fx-glow { animation: glow 1.5s infinite alternate; }
.fx-pop-out { animation: pop-out 0.5s forwards; }
.fx-bounce-menu { animation: bounceIn 0.5s ease-out; }

/* NUEVAS ANIMACIONES */
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

@keyframes bounceInDown {
  from,
  60%,
  75%,
  90%,
  to {
    animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
  }
  0% {
    opacity: 0;
    transform: translate3d(0, -3000px, 0) scale(0.5);
  }
  60% {
    opacity: 1;
    transform: translate3d(0, 25px, 0) scale(1);
  }
  75% {
    transform: translate3d(0, -10px, 0);
  }
  90% {
    transform: translate3d(0, 5px, 0);
  }
  to {
    transform: translate3d(0, 0, 0);
  }
}

.fx-pulse { animation: pulse 2s infinite ease-in-out; }
.fx-bounce-in-down { animation: bounceInDown 1s both; }

@keyframes shake {
  10%, 90% { transform: translate3d(-1px, 0, 0); }
  20%, 80% { transform: translate3d(2px, 0, 0); }
  30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
  40%, 60% { transform: translate3d(4px, 0, 0); }
}

@keyframes pop {
  0% { transform: scale(0); }
  100% { transform: scale(1); }
}

@keyframes pop-out {
  0% { opacity: 1; transform: scale(1); }
  100% { opacity: 0; transform: scale(1.2); }
}

@keyframes glow {
  from { box-shadow: 0 0 5px var(--success); }
  to { box-shadow: 0 0 20px var(--success), 0 0 30px var(--success); }
}

@keyframes sparkle {
  0% { opacity: 0; transform: scale(0.5); }
  50% { opacity: 0.4; transform: scale(1.2); }
  100% { opacity: 0; transform: scale(0.5); }
}

@keyframes bounceIn {
  0%, 20%, 40%, 60%, 80%, 100% {
    transition-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
  }
  0% {
    opacity: 0;
    transform: scale3d(0.3, 0.3, 0.3);
  }
  20% {
    transform: scale3d(1.1, 1.1, 1.1);
  }
  40% {
    transform: scale3d(0.9, 0.9, 0.9);
  }
  60% {
    opacity: 1;
    transform: scale3d(1.03, 1.03, 1.03);
  }
  80% {
    transform: scale3d(0.97, 0.97, 0.97);
  }
  100% {
    opacity: 1;
    transform: scale3d(1, 1, 1);
  }
}

/* Media queries */
@media (max-width: 768px) {
  #stageBottom { padding: var(--space-unit); }
  .btn { padding: 0.75rem 1.5rem; font-size: 1rem; }
  .question-prompt { font-size: 1.5rem; }
  .options-grid { grid-template-columns: 1fr; }
}

/* Estilos para "Les maisons des nombres" */
.number-house-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: var(--bg2);
  border-radius: 2rem;
  box-shadow: var(--shadow-medium);
  width: 100%;
}
.rooftop {
  font-family: var(--font-heading);
  font-size: var(--font-size-xxl);
  background: var(--primary-light);
  color: white;
  padding: 0.5rem 1.5rem;
  border-radius: 1rem 1rem 0 0;
  box-shadow: var(--shadow-small);
}
.windows {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  width: 100%;
  padding: 1rem;
}
.window-row {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.5rem;
  width: 100%;
}
.window-number, .window-input {
  font-family: var(--font-body);
  font-size: var(--font-size-large);
  background: white;
  padding: 0.75rem;
  border-radius: 0.5rem;
  box-shadow: var(--shadow-small);
  min-width: 60px;
  text-align: center;
  border: 2px solid transparent;
}
.window-number {
  background: var(--p2);
  color: var(--ink);
}
.window-input {
  background: var(--p3);
  border: 2px solid var(--p1);
  outline: none;
  transition: all 0.2s;
}
.window-input:focus {
  border-color: var(--primary-light);
  transform: scale(1.05);
}
.window-input.correct {
  border-color: var(--success);
  background: #e6ffec;
}
.window-input.incorrect {
  border-color: var(--danger);
  background: #ffe6e6;
}
.plus-sign, .equal-sign {
  font-family: var(--font-heading);
  font-size: var(--font-size-xl);
  color: var(--muted);
}
.submit-btn {
  font-family: var(--font-heading);
  font-size: var(--font-size-large);
  padding: 0.75rem 2rem;
  border-radius: 1rem;
  border: none;
  cursor: pointer;
  box-shadow: var(--shadow-small);
  background: var(--primary);
  color: white;
  transition: all 0.2s;
  margin-top: 1rem;
}

/* Estilos para "Les Couleurs" */
.color-option-button {
  padding: 0.75rem 1.5rem;
  border-radius: 1rem;
  border: none;
  cursor: pointer;
  box-shadow: var(--shadow-small);
  transition: all 0.2s ease-in-out;
  flex-grow: 1;
  max-width: 200px;
  font-size: var(--font-size-large);
  font-family: var(--font-body);
  color: white;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
}
.color-option-button:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-medium);
}
/* Specific color classes */
.color-blue { background-color: #42a5f5; }
.color-yellow { background-color: #ffee58; color: var(--ink); }
.color-red { background-color: #ef5350; }
.color-green { background-color: #66bb6a; }
.color-orange { background-color: #ff9800; }
.color-purple { background-color: #ab47bc; }
.color-white { background-color: white; color: var(--ink); }
.color-black { background-color: black; }
.color-pink { background-color: #ec407a; }
.color-light-blue { background-color: #29b6f6; }
.color-light-green { background-color: #9ccc65; }

/* Estilos para "Contes Magiques" */
.story-container {
  text-align: left;
  position: relative;
}
.story-container h2 {
  font-family: var(--font-heading);
  color: var(--primary);
  text-align: center;
}
.story-container img {
  max-width: 100%;
  height: auto;
  border-radius: 1rem;
  margin-bottom: 1rem;
}
.sparkle {
  animation: sparkle 2s ease-in-out infinite;
  position: absolute;
  font-size: 2rem;
  z-index: 10;
  pointer-events: none;
  opacity: 0;
}

/* Estilos para "M√©moire Magique" */
.memory-grid {
    display: grid;
    /* Aqu√≠ se define la estructura de columnas.
       'repeat(4, 1fr)' crea 4 columnas de igual ancho.
       Esto se ajustar√° din√°micamente seg√∫n el nivel del juego. */
    grid-template-columns: repeat(4, 1fr);
    gap: 10px; /* Espacio entre las cartas */
    width: 100%;
    max-width: 500px; /* Ancho m√°ximo del contenedor del grid */
    margin: 0 auto; /* Centra el grid en la p√°gina */
}
.memory-card {
    background-color: var(--primary); /* Color de fondo inicial */
    border-radius: 10px; /* Bordes redondeados */
    height: 100px; /* Altura fija de la carta */
    display: grid; /* Utiliza grid para centrar el contenido */
    justify-content: center; /* Centra el contenido horizontalmente */
    align-items: center; /* Centra el contenido verticalmente */
    font-size: 2rem; /* Tama√±o de la fuente (si hay contenido visible) */
    cursor: pointer; /* Cambia el cursor a una mano al pasar sobre la carta */
    transform: rotateY(180deg); /* Carta inicialmente volteada (oculta) */
    transition: transform 0.6s; /* Transici√≥n suave para el volteo */
    box-shadow: var(--shadow-small); /* Sombra sutil */
}

/* Estilos para cartas que han coincidido */
.memory-card.matched {
    cursor: default; /* Cursor normal para cartas que ya coincidieron */
    background-color: var(--success); /* Color de fondo indicando coincidencia */
    transition: background-color 0.5s; /* Transici√≥n suave del color */
    pointer-events: none; /* Deshabilita interacciones sobre cartas coincididas */
}
.memory-card.flipped {
    transform: rotateY(0deg);
    background-color: var(--card);
}
/* Estilos para cartas deshabilitadas (durante comparaciones o si ya coincidieron) */
.memory-card.disabled {
    pointer-events: none; /* Deshabilita cualquier interacci√≥n */
}
/* Estilos para el juego de ordenar */
.sorting-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.5rem;
}
.sorting-list {
  display: flex;
  gap: 1rem;
  justify-content: center;
  flex-wrap: wrap;
  padding: 1rem;
  border: 2px dashed var(--primary);
  border-radius: 1rem;
  min-height: 100px;
}
.sortable-item {
  font-family: var(--font-body);
  font-size: var(--font-size-large);
  padding: 0.5rem 1rem;
  background: var(--card);
  border-radius: 0.5rem;
  cursor: grab;
  box-shadow: var(--shadow-small);
  transition: transform 0.2s ease-in-out;
}
.sortable-item:active {
  cursor: grabbing;
  transform: scale(1.1);
  box-shadow: var(--shadow-medium);
}
.sort-input {
  width: 80px;
  text-align: center;
  font-size: var(--font-size-large);
  border-radius: 0.5rem;
  border: 1px solid var(--muted);
  padding: 0.5rem;
}
.image-container {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    max-width: 300px;
    margin: 1rem auto;
}
.image-container img {
    max-width: 100%;
    border-radius: 1rem;
    box-shadow: var(--shadow-medium);
}
.word-with-blank {
    font-family: var(--font-heading);
    font-size: var(--font-size-xxl);
    text-transform: uppercase;
    letter-spacing: 5px;
}
.blank {
    display: inline-block;
    width: 30px;
    height: 35px;
    border-bottom: 3px solid var(--ink);
    margin: 0 5px;
}
.sequence-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
    font-size: var(--font-size-xl);
}
.sequence-item {
    font-size: var(--font-size-xl);
    padding: 0.5rem 1rem;
    border-radius: 1rem;
    background: var(--bg2);
    box-shadow: var(--shadow-small);
    border: 2px solid transparent;
}
.sequence-item.selected {
    border-color: var(--primary-light);
    transform: scale(1.05);
}
</style>
</head>
<body class="body-level-1">
  <div id="stageTop">
    <div class="scores-container">
      <span id="scoreStars">0</span>
      <span id="scoreCoins" class="coins">0</span>
      <span id="level" class="level">Niveau 1</span>
    </div>
    <button id="btnBack" class="btn">Retourner</button>
  </div>

  <div id="stageBottom">
    <div id="content">
    </div>
    
    <div id="stageBtns">
      <button id="btnPrev" class="btn" aria-label="Pr√©c√©dent">Pr√©c√©dent</button>
      <button id="btnSkip" class="btn" aria-label="Passer">Passer</button>
    </div>
  </div>

  <audio id="audioCorrect" src="https://assets.mixkit.co/sfx/download/mixkit-game-bling-2041.wav"></audio>
  <audio id="audioWrong" src="https://assets.mixkit.co/sfx/download/mixkit-wrong-answer-2051.wav"></audio>

  <script src="https://cdn.jsdelivr.net/npm/tsparticles-confetti@2.12.0/tsparticles.confetti.bundle.min.js"></script>
  <script>
    // Configuraci√≥n global del juego
    const LEVELS_PER_TOPIC = 10;
    const QUESTIONS_PER_LEVEL = 5;
    const HOUSE_PAIRS_PER_LEVEL = 10;
    const MEMORY_GAME_LEVELS = [
      { level: 1, pairs: 2, grid: '2x2' },
      { level: 2, pairs: 4, grid: '2x4' },
      { level: 3, pairs: 6, grid: '3x4' },
      { level: 4, pairs: 8, grid: '4x4' },
      { level: 5, pairs: 10, grid: '4x5' },
      { level: 6, pairs: 12, grid: '4x6' },
      { level: 7, pairs: 14, grid: '4x7' },
      { level: 8, pairs: 16, grid: '4x8' },
      { level: 9, pairs: 18, grid: '5x8' },
      { level: 10, pairs: 20, grid: '5x8' }
    ];
    
    // Emojis y recursos
    const emoji = {
        blue: 'üîµ', yellow: 'üü°', red: 'üî¥', green: 'üü¢', orange: 'üü†', purple: 'üü£',
        car: 'üöó', bus: 'üöå', plane: '‚úàÔ∏è', rocket: 'üöÄ', star: '‚≠ê', coin: 'üí∞', sparkle: '‚ú®',
        bear: 'üêª', rabbit: 'üê∞', dog: 'üê∂', cat: 'üê±', fish: 'üê†', frog: 'üê∏', bird: 'üê¶', panda: 'üêº',
        sort: 'üóÇÔ∏è', riddle: 'ü§î', vowel: 'üÖ∞Ô∏è', shape: 'üî∑', sequence: '‚û°Ô∏è'
    };
    
    // Contenido del juego
    const positiveMessages = ['ü¶Ñ Bravo !', '‚ú® Super !', 'üåà G√©nial !', 'üåü Parfait !'];
    const magicStories = [
    
  {
    "title": "Le Voyage de L√©na l'√âtoile ‚≠êÔ∏è",
    "image": "https://photos.app.goo.gl/fkh9KiXZNouPpshj7",
    "text": [
      "L√©na üëß √©tait une petite √©toile ‚≠êÔ∏è brillante ‚ú® comme un diamant üíé.",
      "Elle vivait üè° sur une montagne ‚õ∞Ô∏è magique ‚ú® avec sa petite s≈ìur Yaya üëß.",
      "Un jour ‚òÄÔ∏è, L√©na ‚≠êÔ∏è d√©cida üó∫Ô∏è de faire un grand voyage üöÄ pour trouver üîç le plus beau arc-en-ciel üåà.",
      "Yaya üëß, tr√®s curieuse üëÄ, la rejoignit ü§ù.",
      "Elles saut√®rent ü§∏ de nuage ‚òÅÔ∏è en nuage ‚òÅÔ∏è. C'√©tait un jeu üé≤ tr√®s amusant üòÑ !",
      "Finalement üéâ, elles trouv√®rent üîé un arc-en-ciel üåà g√©ant üèûÔ∏è. Mission accomplie üèÜ !",
      "L√©na ‚≠êÔ∏è et Yaya üëß avaient fait un voyage üöÄ inoubliable üíñ."
    ],
    "quiz": [
      { "question": "Qui est L√©na üëß ?", "options": ["Une princesse üëë", "Une √©toile ‚≠êÔ∏è", "Un animal üêæ"], "correct": 1 },
      { "question": "O√π vivait L√©na ‚≠êÔ∏è ?", "options": ["Dans une for√™t üå≥", "Sur une montagne magique ‚õ∞Ô∏è‚ú®", "Dans un ch√¢teau üè∞"], "correct": 1 },
      { "question": "Qu'ont-elles trouv√© üîç ?", "options": ["Une fleur üå∏", "Un tr√©sor üí∞", "Un arc-en-ciel üåà"], "correct": 2 }
    ]
  },
  {
    "title": "Le Lion au Grand Coeur ü¶Åüíñ",
    "image": "https://via.placeholder.com/600x400.png?text=Le+lion+au+grand+coeur",
    "text": [
      "Dans la savane üåç vivait un lion ü¶Å nomm√© L√©o.",
      "Il n'√©tait pas le plus fort üí™, mais il √©tait le plus courageux üíñ et le plus gentil ü§ó.",
      "L√©na üëß et Yaya üëß √©taient ses meilleures amies üë≠.",
      "Un jour ‚òÄÔ∏è, une petite antilope ü¶å se retrouva coinc√©e üò® dans un mar√©cage ü™µ.",
      "L√©na üëß et Yaya üëß √©taient inqui√®tes üòü.",
      "L√©o ü¶Å, sans h√©siter ‚ö°, sauta ü§æ dans la boue üåø pour la sauver üôå.",
      "Les autres animaux üêíü¶ìüêò applaudirent üëè.",
      "L√©o ü¶Å avait montr√© que le courage üíñ ne se mesure pas √† la force üí™, mais √† la gentillesse ü§ó.",
      "L√©na üëß et Yaya üëß √©taient si fi√®res üåü de leur ami ü¶Å."
    ],
    "quiz": [
      { "question": "Comment s'appelle le lion ü¶Å ?", "options": ["L√©o ü¶Å", "Max üêØ", "Simba üêæ"], "correct": 0 },
      { "question": "Qu'est-ce qui le rendait courageux üíñ ?", "options": ["Sa force üí™", "Sa gentillesse ü§ó", "Sa vitesse üèÉ‚Äç‚ôÇÔ∏è"], "correct": 1 },
      { "question": "Quel animal üêæ L√©o ü¶Å a-t-il sauv√© üôå ?", "options": ["Un z√®bre ü¶ì", "Une antilope ü¶å", "Une girafe ü¶í"], "correct": 1 }
    ]
  },
  {
    "title": "Le Petit Nuage Heureux ‚òÅÔ∏èüòä",
    "image": "https://via.placeholder.com/600x400.png?text=Le+petit+nuage+heureux",
    "text": [
      "C'√©tait une journ√©e üåßÔ∏è triste üò¢.",
      "Le soleil ‚òÄÔ∏è √©tait cach√© derri√®re de gros nuages ‚òÅÔ∏è gris.",
      "L√©na üëß et Yaya üëß cherchaient des couleurs üåà.",
      "Mais parmi eux, il y avait un petit nuage ‚òÅÔ∏è blanc ‚ö™ et joyeux üòÉ nomm√© Fluffy ‚òÅÔ∏è.",
      "Fluffy ‚òÅÔ∏è voulait rendre les enfants üëßüë¶ heureux üòÑ.",
      "Il vit une petite fille üëß qui pleurait üò¢ car elle n'avait pas de parapluie ‚òî.",
      "Fluffy ‚òÅÔ∏è d√©cida de se transformer ‚ú® en un arc-en-ciel üåà.",
      "Il s'√©tira ‚û°Ô∏è et changea üîÑ de couleurs üåà, illuminant üí° le ciel ‚òÄÔ∏è.",
      "L√©na üëß et Yaya üëß √©taient √©merveill√©es üòç !",
      "La petite fille üëß leva les yeux üëÄ, sourit üòÑ et se mit √† rire üòÇ.",
      "Fluffy ‚òÅÔ∏è √©tait si fier üåü.",
      "Il avait compris que partager ü§ù sa joie üòÑ √©tait la plus belle üåπ des choses.",
      "L√©na üëß et Yaya üëß l'avaient aid√© en partageant leur bonheur üíñ."
    ],
    "quiz": [
      { "question": "Comment s'appelle le petit nuage ‚òÅÔ∏è ?", "options": ["Fluffy ‚òÅÔ∏è", "Coco üêª", "Grisou üå´Ô∏è"], "correct": 0 },
      { "question": "En quoi s'est-il transform√© ‚ú® ?", "options": ["Un √©clair ‚ö°", "Un arc-en-ciel üåà", "De la pluie üåßÔ∏è"], "correct": 1 },
      { "question": "Quelle le√ßon a-t-il apprise üìñ ?", "options": ["√ätre triste üò¢", "Partager sa joie üòÑ", "Rester immobile ü™®"], "correct": 1 }
    ]
  },
  {
    "title": "Le Ch√™ne et la F√©e üå≥üßö",
    "image": "https://via.placeholder.com/600x400.png?text=Le+chene+et+la+fee",
    "text": [
      "Dans une for√™t üå≥ ancienne vivait un vieux ch√™ne üå≥ sage üìö.",
      "L√©na üëß, la jeune f√©e üßö, voulait devenir la gardienne üõ°Ô∏è de la for√™t üå≥.",
      "Yaya üëß, sa petite s≈ìur üëß, voulait l'aider ü§ù.",
      "Le ch√™ne üå≥ leur enseigna üìñ les secrets üîë de la nature üåø, un par un 1Ô∏è‚É£.",
      "Chaque jour üìÖ, L√©na üëß et Yaya üëß √©tudiaient üìö les plantes üå±, les rivi√®res üåä et les animaux üêøÔ∏è.",
      "C'√©tait difficile üò£ et long ‚è≥.",
      "Parfois, elles voulaient abandonner üòî.",
      "Mais le ch√™ne üå≥ leur dit üí¨: 'La connaissance üìö ne se cueille pas üö´üå∏, elle se cultive üå±.'",
      "Soyez patientes ‚è≥.",
      "Des ann√©es plus tard ‚åõ, L√©na üëß devint la f√©e üßö la plus sage üìñ de la for√™t üå≥.",
      "Elle avait compris que l'√©tude üìö et la patience ‚è≥ √©taient les cl√©s üîë pour atteindre ses r√™ves üåü.",
      "Yaya üëß √©tait sa meilleure alli√©e ü§ù.",
      "Leur amour üíñ pour la for√™t üå≥ √©tait leur plus grande force üí™."
    ],
    "quiz": [
      { "question": "Qui est L√©na üëß ?", "options": ["Un ch√™ne üå≥", "Une f√©e üßö", "Une princesse üëë"], "correct": 1 },
      { "question": "Qui leur a enseign√© üìñ les secrets de la nature üåø ?", "options": ["Le vieux ch√™ne üå≥", "Un oiseau üê¶", "Le vent üå¨Ô∏è"], "correct": 0 },
      { "question": "Quelle a √©t√© leur plus grande le√ßon üìñ ?", "options": ["La force üí™ et la rapidit√© üèÉ", "La connaissance üìö et la patience ‚è≥", "La magie ‚ú® et la col√®re üò°"], "correct": 1 }
    ]
  },
  {
    "title": "Le Lapin Volant üêáüöÄ",
    "image": "https://via.placeholder.com/600x400.png?text=Le+lapin+volant",
    "text": [
      "L√©o le lapin üê∞ r√™vait de voler üöÄ.",
      "Tous les autres animaux de la for√™t üå≥ se moquaient de lui üòî, car les lapins ne volent pas üö´.",
      "L√©na üëß et Yaya üëß croyaient en lui üíñ.",
      "Elles l'aid√®rent √† construire une machine ‚öôÔ∏è volante avec des feuilles üçÉ et des branches üå≥.",
      "Un jour ‚òÄÔ∏è, L√©o üê∞ sauta du haut d'une colline ‚õ∞Ô∏è.",
      "Il tomba un peu au d√©but üìâ, mais ensuite, sa machine ‚öôÔ∏è s'√©leva üìà dans les airs ‚ú®.",
      "Les autres animaux üêøÔ∏èü¶äüêª √©taient stup√©faits üòÆ !",
      "L√©o üê∞ n'avait pas les ailes ü¶Ö d'un oiseau üê¶, mais il avait le courage üíñ de croire en lui üåü.",
      "L√©na üëß et Yaya üëß √©taient si heureuses üòÑ pour leur ami üêá.",
      "Elles avaient appris que la pers√©v√©rance üßó et le soutien ü§ù peuvent faire des miracles ‚ú®."
    ],
    "quiz": [
      { "question": "Que voulait L√©o le lapin üê∞ ?", "options": ["Courir vite üèÉ", "Sauter haut ü§∏", "Voler üöÄ"], "correct": 2 },
      { "question": "Qui a aid√© L√©o üê∞ √† construire sa machine ‚öôÔ∏è ?", "options": ["Un ours üêª", "L√©na üëß et Yaya üëß", "Un oiseau üê¶"], "correct": 1 },
      { "question": "Quelle est la morale de cette histoire üìñ ?", "options": ["Il faut √™tre le plus fort üí™", "Il faut √©couter les autres üëÇ", "Croire en soi et pers√©v√©rer üåü"], "correct": 2 }
    ]
  },
  {
    "title": "Le Tr√©sor de la Rivi√®re Brillante üíéüåä",
    "image": "https://via.placeholder.com/600x400.png?text=Le+tresor+de+la+riviere",
    "text": [
      "Au fin fond d'une for√™t myst√©rieuse üå≥, se cachait la Rivi√®re Brillante ‚ú®.",
      "L√©na üëß et Yaya üëß d√©cid√®rent üó∫Ô∏è d'y chercher un tr√©sor üí∞ cach√©.",
      "Elles trouv√®rent une carte üó∫Ô∏è qui montrait un chemin üõ§Ô∏è rempli d'√©nigmes üß† et de d√©fis üßó.",
      "Le premier d√©fi üßó √©tait de sauter par-dessus des rochers ü™®.",
      "Le deuxi√®me √©tait de traverser une cascade üèûÔ∏è sans se mouiller üí¶.",
      "Chaque fois qu'elles r√©solvaient une √©nigme üß†, un indice üîë apparaissait.",
      "Finalement üéâ, elles arriv√®rent √† la fin de la carte üó∫Ô∏è.",
      "Le tr√©sor üí∞ n'√©tait pas de l'or ü•á ou des diamants üíé.",
      "C'√©tait une graine ‚ú® magique ü™Ñ qui, une fois plant√©e üå±, faisait pousser un arbre üå≥ qui donnait des fruits üçé qui rendaient les gens heureux üòÑ.",
      "L√©na üëß et Yaya üëß avaient compris que le vrai tr√©sor üíé √©tait de partager ü§ù le bonheur üòä et la joie üòÑ.",
      "Elles avaient accompli un voyage üöÄ inoubliable üíñ."
    ],
    "quiz": [
      { "question": "Quel tr√©sor üí∞ cherchaient L√©na üëß et Yaya üëß ?", "options": ["Une graine magique ‚ú®", "De l'or ü•á", "Des diamants üíé"], "correct": 0 },
      { "question": "Qu'est-ce qui les aidait √† trouver le chemin üõ§Ô∏è ?", "options": ["Des √©nigmes üß†", "Des animaux üêí", "Des oiseaux üê¶"], "correct": 0 },
      { "question": "O√π se trouvait la graine magique ‚ú® ?", "options": ["Au fond de la mer üåä", "Dans un coffre üì¶", "Au bout du chemin üõ§Ô∏è"], "correct": 2 }
    ]
  }
    ];

    const colorMap = {
        'üü¢ Vert': 'green', 'üü† Orange': 'orange', 'üü£ Violet': 'purple',
        'üîµ Bleu': 'blue', 'üü° Jaune': 'yellow', 'üî¥ Rouge': 'red',
        '‚ö´ Noir': 'black', '‚ö™ Blanc': 'white', 'üíó Rose': 'pink',
        'üíß Bleu Clair': 'light-blue', 'üçÉ Vert Clair': 'light-green',
        '‚ö™ Blanc + üî¥ Rouge': 'pink', 'üîµ Bleu + üü° Jaune': 'green', 'üî¥ Rouge + üü° Jaune': 'orange', 'üîµ Bleu + üî¥ Rouge': 'purple',
    };
    
    // Contenido para el juego de adivinanzas
    const riddles = [
        {
            riddle: "Je suis un animal qui vit dans la mer, mais je ne suis pas un poisson. J'ai huit bras. Qui suis-je?",
            options: ["Une baleine", "Un requin", "Une pieuvre", "Un crabe"],
            correct: 2,
            reward: { stars: 15, coins: 10 }
        },
        {
            riddle: "Je suis grand et vert, et je n'ai pas de bras. Je peux te donner des fruits ou de l'ombre. Qui suis-je?",
            options: ["Une fleur", "Un arbre", "Un champignon", "Une carotte"],
            correct: 1,
            reward: { stars: 15, coins: 10 }
        },
        {
            riddle: "J'ai des rayures noires et blanches, mais je ne suis pas un tigre. Je vis dans la savane africaine. Qui suis-je?",
            options: ["Un z√®bre", "Un gu√©pard", "Une girafe", "Un ours"],
            correct: 0,
            reward: { stars: 15, coins: 10 }
        },
        {
            riddle: "Je suis une petite chose qui peut voler sans ailes. Quand tu me donnes de l'air, je monte et je danse. Qui suis-je?",
            options: ["Une balle", "Un cerf-volant", "Une fus√©e", "Un oiseau"],
            correct: 1,
            reward: { stars: 15, coins: 10 }
        },
        {
            riddle: "Je suis une lumi√®re üí° qui brille la nuit üåô. Je te guide quand il fait noir üåë. Qui suis-je?",
            options: ["Une voiture üöó", "Une √©toile ‚ú®", "Une bougie üïØÔ∏è"],
            correct: 1,
            reward: { stars: 20, coins: 15 }
        },
        {
            riddle: "Je suis doux et blanc ‚òÅÔ∏è. Je vole dans le ciel ‚òÅÔ∏è. On me voit avant qu'il pleuve üåßÔ∏è. Qui suis-je?",
            options: ["Un oiseau üê¶", "Un nuage ‚òÅÔ∏è", "Une feuille üçÇ"],
            correct: 1,
            reward: { stars: 20, coins: 15 }
        },
        {
            riddle: "Je suis le roi üëë de la jungle üå≥. J'ai une grande crini√®re. Qui suis-je?",
            options: ["Un lion ü¶Å", "Un tigre üêØ", "Un ours üêª"],
            correct: 0,
            reward: { stars: 20, coins: 15 }
        },
        {
            riddle: "J'ai des dents ü¶∑ mais je ne peux pas manger. Je peux te donner de la couleur üé®. Qui suis-je?",
            options: ["Un peigne üíá", "Une fourchette üç¥", "Un crayon ‚úèÔ∏è"],
            correct: 2,
            reward: { stars: 25, coins: 20 }
        },
        {
            riddle: "Je suis une b√™te üëπ qui a une corne ü¶Ñ sur le nez üëÉ. Qui suis-je?",
            options: ["Une girafe ü¶í", "Un rhinoc√©ros ü¶è", "Un √¢ne üê¥"],
            correct: 1,
            reward: { stars: 25, coins: 20 }
        },
        {
            riddle: "Je n'ai pas de jambes üö∂ mais je peux voyager üó∫Ô∏è partout dans le monde. J'ai des villes üèôÔ∏è, des rivi√®res üåä et des montagnes ‚õ∞Ô∏è. Qui suis-je?",
            options: ["Une voiture üöó", "Un avion ‚úàÔ∏è", "Une carte üó∫Ô∏è"],
            correct: 2,
            reward: { stars: 30, coins: 25 }
        }
    ];

    // Nuevo contenido para los nuevos juegos
    const words = [
        { word: 'chat', image: 'https://cdn-icons-png.flaticon.com/512/3602/3602145.png', hint: 'Un animal qui aime les siestes.' },
        { word: 'soleil', image: 'https://cdn-icons-png.flaticon.com/512/869/869869.png', hint: 'Brille dans le ciel le jour.' },
        { word: 'pomme', image: 'https://cdn-icons-png.flaticon.com/512/9187/9187979.png', hint: 'Un fruit rouge ou vert.' },
        { word: 'maison', image: 'https://cdn-icons-png.flaticon.com/512/103/103983.png', hint: 'O√π on habite.' },
        { word: 'livre', image: 'https://cdn-icons-png.flaticon.com/512/29/29291.png', hint: 'On lit des histoires dedans.' },
        { word: 'fleur', image: 'https://cdn-icons-png.flaticon.com/512/1020/1020478.png', hint: 'On en trouve dans les jardins.' },
        { word: 'nuage', image: 'https://cdn-icons-png.flaticon.com/512/1271/1271106.png', hint: 'Il flotte dans le ciel.' },
        { word: 'chien', image: 'https://cdn-icons-png.flaticon.com/512/181/181545.png', hint: 'Le meilleur ami de l\'homme.' },
        { word: '√©toile', image: 'https://cdn-icons-png.flaticon.com/512/5752/5752496.png', hint: 'Brille dans l\'espace.' },
        { word: 'table', image: 'https://cdn-icons-png.flaticon.com/512/1055/1055535.png', hint: 'On y pose son assiette.' }
    ];
    
    const sequences = [
        { items: ['1', '2', '3', '4', '?'], options: ['5', '6', '8'], correct: '5' },
        { items: ['üî¥', 'üîµ', 'üî¥', 'üîµ', '?'], options: ['üî¥', 'üü¢', 'üü°'], correct: 'üî¥' },
        { items: ['A', 'B', 'C', '?'], options: ['E', 'D', 'F'], correct: 'D' },
        { items: ['‚≠ê', '‚≠ê', 'üöÄ', '‚≠ê', '‚≠ê', '?'], options: ['‚≠ê', 'üöÄ', '‚ú®'], correct: 'üöÄ' },
        { items: ['Un', 'Deux', 'Trois', '?'], options: ['Cinq', 'Quatre', 'Six'], correct: 'Quatre' },
        { items: ['Maison', 'M', 'Ma', '?'], options: ['Main', 'Mais', 'Mai'], correct: 'Mai' },
        { items: ['Lundi', 'Mardi', 'Mercredi', '?'], options: ['Jeudi', 'Vendredi', 'Samedi'], correct: 'Jeudi' },
        { items: ['Janvier', 'F√©vrier', 'Mars', '?'], options: ['Mai', 'Avril', 'Juin'], correct: 'Avril' },
        { items: ['0', '10', '20', '?'], options: ['30', '40', '50'], correct: '30' },
        { items: ['Abeille', 'Baleine', 'Canard', '?'], options: ['Chameau', 'Chat', 'Cheval'], correct: 'Chameau' }
    ];

    // Elementos del DOM
    const content = document.getElementById('content');
    const btnBack = document.getElementById('btnBack');
    const scoreStars = document.getElementById('scoreStars');
    const scoreCoins = document.getElementById('scoreCoins');
    const levelDisplay = document.getElementById('level');
    const audioCorrect = document.getElementById('audioCorrect');
    const audioWrong = document.getElementById('audioWrong');
    
    let currentTopic = '';
    let currentLevel = 1;
    let currentQuestionIndex = 0;
    let userScore = { stars: 0, coins: 0 };
    let answeredQuestions = {};
    let storyQuiz = [];
    
    // Base de datos de preguntas generadas din√°micamente
    const allQuestions = {
        additions: [], soustractions: [], multiplications: [], colors: [], stories: [], riddles: [], sorting: [], letters: [], shapes: [], vowels: [], sequences: []
    };
    
    /* === Funciones Auxiliares === */
    function speakText(text) {
        if (window.speechSynthesis) {
            const synth = window.speechSynthesis;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'fr-FR';
            synth.speak(utterance);
        }
    }
    
    function playSound(type) {
        if (type === 'correct') {
            audioCorrect.currentTime = 0;
            audioCorrect.play();
        } else if (type === 'wrong') {
            audioWrong.currentTime = 0;
            audioWrong.play();
        }
    }

    function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
    }
    
    function updateUI() {
        scoreStars.textContent = userScore.stars;
        scoreCoins.textContent = userScore.coins;
        levelDisplay.textContent = `Niveau ${currentLevel}`;
        document.body.className = `body-level-${currentLevel}`;
    }
    
    function showSuccessMessage(message = positiveMessages[Math.floor(Math.random() * positiveMessages.length)]) {
        const promptEl = document.createElement('div');
        promptEl.className = 'prompt ok fx-pop';
        promptEl.textContent = message;
        content.appendChild(promptEl);
        speakText(message);
        playSound('correct');
        setTimeout(() => promptEl.remove(), 1000);
    }
    
    function showErrorMessage(message, correctValue) {
        const promptEl = document.createElement('div');
        promptEl.className = 'prompt bad fx-shake';
        promptEl.textContent = `${message} La bonne r√©ponse √©tait : ${correctValue}.`;
        content.appendChild(promptEl);
        speakText(message);
        playSound('wrong');
        setTimeout(() => promptEl.remove(), 2500);
    }

    function showConfetti() {
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 }
        });
    }

    /* === Generaci√≥n de Contenido === */
    function generateMathQuestion(type, level) {
        let num1, num2, correct, max;
        const rewards = { additions: 10, soustractions: 10, multiplications: 15 };

        if (level <= 3) max = 10;
        else if (level <= 6) max = 50;
        else max = 100;

        switch(type) {
            case 'additions':
                num1 = Math.floor(Math.random() * (max - 1)) + 1;
                num2 = Math.floor(Math.random() * (max - num1)) + 1;
                correct = num1 + num2;
                break;
            case 'soustractions':
                num1 = Math.floor(Math.random() * (max - 1)) + 10;
                num2 = Math.floor(Math.random() * num1);
                correct = num1 - num2;
                break;
            case 'multiplications':
                if (level <= 5) {
                    num1 = Math.floor(Math.random() * 10) + 1;
                    num2 = Math.floor(Math.random() * 10) + 1;
                } else {
                    num1 = Math.floor(Math.random() * 15) + 1;
                    num2 = Math.floor(Math.random() * 15) + 1;
                }
                correct = num1 * num2;
                break;
        }

        const options = shuffle([correct, correct + 1, correct - 1, correct + 2].filter(n => n >= 0 && n !== correct).slice(0, 3).concat(correct));
        return {
            questionText: `Combien font ${num1} ${type === 'additions' ? '+' : type === 'soustractions' ? '-' : 'x'} ${num2}?`,
            options: options,
            correct: options.indexOf(correct),
            difficulty: level,
            reward: { stars: level * rewards[type], coins: level * (rewards[type] / 2) }
        };
    }
    
    function generateColorQuestion(level) {
        let questionData = {};
        const allColors = Object.keys(colorMap);
        const primaryColors = ['üîµ Bleu', 'üü° Jaune', 'üî¥ Rouge'];
        const secondaryColors = ['üü¢ Vert', 'üü† Orange', 'üü£ Violet'];
        
        if (level <= 4) {
            const color = shuffle(primaryColors)[0];
            questionData = { questionText: `Quelle est la couleur ${color}?`, correct: color };
        } else if (level <= 7) {
            const combinations = shuffle([
                { text: `üîµ Bleu + üü° Jaune`, result: 'üü¢ Vert' },
                { text: `üî¥ Rouge + üü° Jaune`, result: 'üü† Orange' },
                { text: `üîµ Bleu + üî¥ Rouge`, result: 'üü£ Violet' }
            ]);
            const combo = combinations[0];
            questionData = { questionText: `Quelle couleur obtient-on en m√©langeant ${combo.text}?`, correct: combo.result };
        } else {
            const color = shuffle(allColors.filter(c => !primaryColors.includes(c) && !secondaryColors.includes(c)))[0];
            questionData = { questionText: `Quelle couleur est ${color}?`, correct: color };
        }

        let options = [questionData.correct];
        while (options.length < 4) {
            const randomColor = shuffle(allColors)[0];
            if (!options.includes(randomColor)) {
                options.push(randomColor);
            }
        }
        questionData.options = shuffle(options);
        questionData.correct = questionData.options.indexOf(questionData.correct);
        return { ...questionData, difficulty: level, reward: { stars: 20, coins: 15 } };
    }

    function initializeQuestions() {
        for (let level = 1; level <= LEVELS_PER_TOPIC; level++) {
            for (let i = 0; i < QUESTIONS_PER_LEVEL; i++) {
                allQuestions.additions.push(generateMathQuestion('additions', level));
                allQuestions.soustractions.push(generateMathQuestion('soustractions', level));
                allQuestions.multiplications.push(generateMathQuestion('multiplications', level));
                allQuestions.colors.push(generateColorQuestion(level));
            }
        }
    }

    /* === Gesti√≥n de pantallas === */
    function showTopicMenu() {
        content.innerHTML = '';
        const prompt = document.createElement('div');
        prompt.className = 'question-prompt fx-bounce-in-down';
        prompt.textContent = 'S√©lectionne un sujet pour commencer.';
        content.appendChild(prompt);
        speakText('S√©lectionne un sujet pour commencer.');

        const topicsContainer = document.createElement('div');
        topicsContainer.className = 'options-grid';
        
        const allTopics = [
            { id: 'additions', text: '‚ûï Additions' },
            { id: 'soustractions', text: '‚ûñ Soustractions' },
            { id: 'multiplications', text: '‚úñÔ∏è Multiplications' },
            { id: 'number-houses', text: 'üè† Maisons des Nombres' },
            { id: 'colors', text: 'üé® Les Couleurs' },
            { id: 'stories', text: 'üìö Contes Magiques' },
            { id: 'memory', text: 'üß† M√©moire Magique' },
            { id: 'sorting', text: 'üóÇÔ∏è Jeu de Tri' },
            { id: 'riddles', text: 'ü§î Jeu d\'√©nigmes' },
            { id: 'vowels', text: 'üÖ∞Ô∏è Jeu des Vocales' },
            { id: 'sequences', text: '‚û°Ô∏è Jeu des S√©quences' },
        ];

        allTopics.forEach(topic => {
            const btn = document.createElement('button');
            btn.className = 'topic-btn fx-bounce-in-down';
            btn.innerHTML = topic.text;
            btn.dataset.topic = topic.id;
            btn.style.animationDelay = `${Math.random() * 0.5}s`;
            btn.addEventListener('click', () => {
                currentTopic = topic.id;
                if (topic.id === 'stories') { showStoryMenu(); }
                else if (topic.id === 'memory') { showMemoryGameMenu(); }
                else if (topic.id === 'sorting') { showSortingGame(1); }
                else if (topic.id === 'riddles') { showRiddleGame(); }
                else if (topic.id === 'vowels') { showVowelGame(); }
                else if (topic.id === 'sequences') { showSequenceGame(); }
                else if (topic.id === 'number-houses') { showNumberHousesGame(1); }
                else { showLevelMenu(topic.id); }
            });
            topicsContainer.appendChild(btn);
        });
        content.appendChild(topicsContainer);

        btnBack.style.display = 'none';
        document.body.className = `body-level-1`;
    }

    function showLevelMenu(topic) {
        currentTopic = topic;
        content.innerHTML = '';
        const title = document.createElement('div');
        title.className = 'question-prompt fx-bounce-in-down';
        title.textContent = `Choisis un niveau pour ${topic}`;
        content.appendChild(title);
        speakText(`Choisis un niveau pour ${topic}`);

        const levelsContainer = document.createElement('div');
        levelsContainer.className = 'options-grid';

        const maxLevels = {
            'additions': 10,
            'soustractions': 10,
            'multiplications': 10,
            'number-houses': 10,
            'colors': 10,
            'memory': MEMORY_GAME_LEVELS.length,
            'sorting': 10,
            'riddles': riddles.length,
            'vowels': words.length,
            'sequences': sequences.length,
            'stories': magicStories.length
        };
        const totalLevels = maxLevels[currentTopic] || LEVELS_PER_TOPIC;
        
        for (let i = 1; i <= totalLevels; i++) {
            const levelBtn = document.createElement('div');
            levelBtn.className = 'option level-btn fx-bounce-in-down';
            levelBtn.textContent = `Niveau ${i}`;
            levelBtn.style.animationDelay = `${Math.random() * 0.5}s`;
            if (answeredQuestions[`${currentTopic}-${i}`] === 'completed') {
                levelBtn.classList.add('correct');
            }
            levelBtn.addEventListener('click', () => {
                currentLevel = i;
                if (currentTopic === 'number-houses') { showNumberHousesGame(currentLevel); }
                else if (currentTopic === 'colors') { showColorGame(currentLevel); }
                else if (currentTopic === 'sorting') { showSortingGame(currentLevel); }
                else if (currentTopic === 'vowels') { loadVowelQuestion(currentLevel - 1); }
                else if (currentTopic === 'riddles') { loadRiddleQuestion(currentLevel - 1); }
                else if (currentTopic === 'sequences') { loadSequenceQuestion(currentLevel - 1); }
                else if (currentTopic === 'memory') { showMemoryGame(MEMORY_GAME_LEVELS[currentLevel - 1].pairs); }
                else { currentQuestionIndex = 0; loadQuestion(0); }
            });
            levelsContainer.appendChild(levelBtn);
        }
        content.appendChild(levelsContainer);
        btnBack.style.display = 'inline-block';
        btnBack.textContent = 'Retour aux sujets';
        btnBack.onclick = showTopicMenu;
    }
    
    function handleOptionClick(event) {
        const selected = event.target;
        const options = document.querySelectorAll('.option');
        options.forEach(opt => opt.removeEventListener('click', handleOptionClick));
        
        const questionsForLevel = allQuestions[currentTopic].filter(q => q.difficulty === currentLevel);
        const questionData = questionsForLevel[currentQuestionIndex];
        
        const userAnswerIndex = parseInt(selected.dataset.index, 10);
        const correctAnswerIndex = questionData.correct;
        const correctValue = questionData.options[correctAnswerIndex];

        if (userAnswerIndex === correctAnswerIndex) {
            selected.classList.add('correct');
            userScore.stars += questionData.reward.stars;
            userScore.coins += questionData.reward.coins;
            showSuccessMessage();
            showConfetti();
        } else {
            selected.classList.add('wrong');
            userScore.coins = Math.max(0, userScore.coins - 5);
            const correctOption = document.querySelector(`.option[data-index="${correctAnswerIndex}"]`);
            if (correctOption) {
                correctOption.classList.add('correct');
            }
            showErrorMessage(`‚ùå -5 pi√®ces.`, correctValue);
        }
        updateUI();

        setTimeout(() => {
            currentQuestionIndex++;
            if (currentQuestionIndex < QUESTIONS_PER_LEVEL) {
                loadQuestion(currentQuestionIndex);
            } else {
                answeredQuestions[`${currentTopic}-${currentLevel}`] = 'completed';
                const winPrompt = document.createElement('div');
                winPrompt.className = 'prompt ok fx-pop';
                winPrompt.textContent = `Bravo, tu as compl√©t√© le Niveau ${currentLevel} !`;
                content.appendChild(winPrompt);
                speakText(`Bravo, tu as compl√©t√© le Niveau ${currentLevel} !`);
                setTimeout(() => showLevelMenu(currentTopic), 2000);
            }
        }, 2500);
    }
    
    function loadQuestion(index) {
        currentQuestionIndex = index;
        content.innerHTML = '';
        updateUI();

        const questionsForLevel = allQuestions[currentTopic].filter(q => q.difficulty === currentLevel);
        const questionData = questionsForLevel[index];
        const fragment = document.createDocumentFragment();

        const title = document.createElement('div');
        title.className = 'question-prompt fx-bounce-in-down';
        title.innerHTML = questionData.questionText;
        fragment.appendChild(title);
        speakText(questionData.questionText);

        const optionsContainer = document.createElement('div');
        optionsContainer.className = 'options-grid';
        
        const shuffledOptions = shuffle([...questionData.options]);
        shuffledOptions.forEach((opt, i) => {
            const optionEl = document.createElement('div');
            optionEl.className = 'option fx-bounce-in-down';
            optionEl.innerHTML = opt;
            optionEl.style.animationDelay = `${i * 0.1 + 0.5}s`;
            const originalIndex = questionData.options.indexOf(opt);
            optionEl.dataset.index = originalIndex;
            optionEl.addEventListener('click', handleOptionClick);
            optionsContainer.appendChild(optionEl);
        });
        fragment.appendChild(optionsContainer);
        content.appendChild(fragment);

        btnBack.style.display = 'inline-block';
        btnBack.textContent = 'Retour aux niveaux';
        btnBack.onclick = () => showLevelMenu(currentTopic);
    }
    /* === Juegos Espec√≠ficos === */
    /**
 * Muestra el juego de las Casas de los N√∫meros.
 * @param {number} level El nivel actual del juego.
 */
function showNumberHousesGame(level) {
    currentLevel = level;
    const content = document.getElementById('content');
    content.innerHTML = ''; 
    updateUI();

    const maxRoofNumber = (level * 5) + 15;
    const roofNumber = Math.floor(Math.random() * (maxRoofNumber - 10)) + 10;
    const pairsCount = Math.min(10, level * 2 + 5); 
    const pairs = generateNumberPairs(roofNumber, pairsCount);

    const container = document.createElement('div');
    container.className = 'number-house-container fx-bounce-in-down';

    const rooftop = document.createElement('div');
    rooftop.className = 'rooftop fx-pulse';
    rooftop.textContent = roofNumber;
    container.appendChild(rooftop);

    const instruction = document.createElement('p');
    instruction.className = 'question-prompt';
    instruction.textContent = `Completa las ${pairsCount} casas de los n√∫meros para llegar a ${roofNumber}.`;
    container.appendChild(instruction);
    speakText(instruction.textContent);

    const windowsContainer = document.createElement('div');
    windowsContainer.className = 'windows';

    pairs.forEach((pair, index) => {
        const row = document.createElement('div');
        row.className = 'window-row';
        const isFirstHidden = Math.random() < 0.5;
        const firstNum = isFirstHidden ? '' : pair[0];
        const secondNum = isFirstHidden ? pair[1] : '';
        const correctValue = isFirstHidden ? pair[0] : pair[1];

        row.innerHTML = `
            ${isFirstHidden ? `<input type="number" class="window-input" data-correct-value="${correctValue}" />` : `<span class="window-number">${firstNum}</span>`}
            <span class="plus-sign">+</span>
            ${isFirstHidden ? `<span class="window-number">${secondNum}</span>` : `<input type="number" class="window-input" data-correct-value="${correctValue}" />`}
            <span class="equal-sign">=</span>
            <span class="window-number">${roofNumber}</span>
        `;
        windowsContainer.appendChild(row);
    });

    container.appendChild(windowsContainer);

    const checkBtn = document.createElement('button');
    checkBtn.id = 'checkHouseBtn';
    checkBtn.className = 'submit-btn fx-bounce-in-down';
    checkBtn.textContent = 'V√©rifier';
    checkBtn.setAttribute('aria-label', 'V√©rifier les r√©ponses');
    checkBtn.style.animationDelay = `${pairs.length * 0.1 + 0.5}s`;
    container.appendChild(checkBtn);
    content.appendChild(container);

    btnBack.style.display = 'inline-block';
    btnBack.textContent = 'Retour aux niveaux';
    btnBack.onclick = () => showLevelMenu(currentTopic);

    checkBtn.addEventListener('click', handleCheckHouses);
}

/**
 * Maneja la l√≥gica de verificaci√≥n del juego.
 */
function handleCheckHouses() {
    const allInputs = document.querySelectorAll('.window-input');
    let allCorrect = true;
    let correctCount = 0;
    const checkBtn = document.getElementById('checkHouseBtn');

    checkBtn.disabled = true;

    let incorrectValues = [];
    allInputs.forEach(input => {
        const inputValue = parseInt(input.value, 10);
        const correctValue = parseInt(input.dataset.correctValue, 10);
        
        input.classList.remove('correct', 'incorrect', 'fx-shake');

        if (inputValue === correctValue) {
            input.classList.add('correct');
            input.disabled = true;
            correctCount++;
        } else {
            input.classList.add('incorrect', 'fx-shake');
            setTimeout(() => input.classList.remove('fx-shake'), 1000);
            userScore.coins = Math.max(0, userScore.coins - 5);
            allCorrect = false;
            incorrectValues.push(`Valor esperado: ${correctValue}`);
        }
    });

    updateUI();

    if (allCorrect) {
        userScore.stars += 50;
        userScore.coins += 50;
        answeredQuestions[`${currentTopic}-${currentLevel}`] = 'completed';
        showSuccessMessage('¬°Bravo! Todas las casas est√°n correctas. ü¶Ñ‚ú®');
        showConfetti();
        checkBtn.textContent = 'Niveau suivant';
        checkBtn.onclick = () => {
            if (currentLevel < LEVELS_PER_TOPIC) {
                showNumberHousesGame(currentLevel + 1);
            } else {
                win();
            }
        };
        checkBtn.disabled = false;
    } else {
        const message = `${correctCount} respuestas correctas. ${allInputs.length - correctCount} incorrectas. -5 monedas.`;
        showErrorMessage(message, incorrectValues.join(', '));
        setTimeout(() => checkBtn.disabled = false, 500); 
    }
}

/**
 * Genera pares de n√∫meros cuya suma es igual a 'sum'.
 * @param {number} sum El valor del tejado de la casa.
 * @param {number} count La cantidad de pares a generar.
 * @returns {Array<Array<number>>} Un array de pares de n√∫meros.
 */
function generateNumberPairs(sum, count) {
    const pairs = [];
    const usedPairs = new Set(); 

    while (pairs.length < count) {
        const num1 = Math.floor(Math.random() * (sum + 1)); 
        const num2 = sum - num1;
        
        const pairKey = num1 < num2 ? `${num1}-${num2}` : `${num2}-${num1}`;

        if (!usedPairs.has(pairKey)) {
            pairs.push([num1, num2]);
            usedPairs.add(pairKey);
        }
    }
    return pairs;
}

    function showColorGame(level) {
        currentTopic = 'colors';
        currentLevel = level;
        currentQuestionIndex = 0;
        loadColorQuestion(0);
    }
    
    function loadColorQuestion(index) {
        currentQuestionIndex = index;
        content.innerHTML = '';
        updateUI();
        
        const questionsForLevel = allQuestions.colors.filter(q => q.difficulty === currentLevel);
        const questionData = questionsForLevel[index];
        const fragment = document.createDocumentFragment();
        
        const title = document.createElement('div');
        title.className = 'question-prompt fx-bounce-in-down';
        title.innerHTML = questionData.questionText;
        fragment.appendChild(title);
        speakText(questionData.questionText);

        const optionsContainer = document.createElement('div');
        optionsContainer.className = 'options-grid';
        
        const shuffledOptions = shuffle([...questionData.options]);
        shuffledOptions.forEach((opt, i) => {
            const optionEl = document.createElement('button');
            optionEl.className = 'color-option-button fx-bounce-in-down';
            optionEl.style.animationDelay = `${i * 0.1 + 0.5}s`;
            const colorName = colorMap[opt];
            if (colorName) { optionEl.classList.add(`color-${colorName}`); }
            optionEl.innerHTML = opt;
            const originalIndex = questionData.options.indexOf(opt);
            optionEl.dataset.index = originalIndex;
            optionEl.addEventListener('click', handleColorOptionClick);
            optionsContainer.appendChild(optionEl);
        });
        fragment.appendChild(optionsContainer);
        content.appendChild(fragment);

        btnBack.style.display = 'inline-block';
        btnBack.textContent = 'Retour aux niveaux';
        btnBack.onclick = () => showLevelMenu(currentTopic);
    }
    
    function handleColorOptionClick(event) {
        const selected = event.target;
        const options = document.querySelectorAll('.color-option-button');
        options.forEach(opt => opt.removeEventListener('click', handleColorOptionClick));
        
        const questionsForLevel = allQuestions.colors.filter(q => q.difficulty === currentLevel);
        const questionData = questionsForLevel[currentQuestionIndex];
        const userAnswerIndex = parseInt(selected.dataset.index, 10);
        const correctAnswerIndex = questionData.correct;
        const correctValue = questionData.options[correctAnswerIndex];

        if (userAnswerIndex === correctAnswerIndex) {
            selected.classList.add('correct');
            userScore.stars += questionData.reward.stars;
            userScore.coins += questionData.reward.coins;
            showSuccessMessage();
            showConfetti();
        } else {
            selected.classList.add('wrong');
            userScore.coins = Math.max(0, userScore.coins - 5);
            const correctOption = document.querySelector(`.color-option-button[data-index="${correctAnswerIndex}"]`);
            if (correctOption) { correctOption.classList.add('correct'); }
            showErrorMessage(`‚ùå -5 pi√®ces.`, correctValue);
        }
        updateUI();
        setTimeout(() => {
            currentQuestionIndex++;
            if (currentQuestionIndex < QUESTIONS_PER_LEVEL) {
                loadColorQuestion(currentQuestionIndex);
            } else {
                answeredQuestions[`${currentTopic}-${currentLevel}`] = 'completed';
                showSuccessMessage(`Bravo, tu as compl√©t√© le Niveau ${currentLevel} !`);
                setTimeout(() => showLevelMenu(currentTopic), 2000);
            }
        }, 2500);
    }

    function showStoryMenu() {
        content.innerHTML = '';
        const title = document.createElement('div');
        title.className = 'question-prompt fx-bounce-in-down';
        title.textContent = 'Choisis un conte magique ‚ú®';
        content.appendChild(title);
        speakText('Choisis un conte magique');
        
        const storiesContainer = document.createElement('div');
        storiesContainer.className = 'options-grid';
        
        magicStories.forEach((story, index) => {
            const storyBtn = document.createElement('button');
            storyBtn.className = 'topic-btn fx-bounce-in-down';
            storyBtn.style.animationDelay = `${index * 0.1}s`;
            storyBtn.innerHTML = `üìö ${story.title}`;
            storyBtn.addEventListener('click', () => showMagicStory(index));
            storiesContainer.appendChild(storyBtn);
        });
        
        content.appendChild(storiesContainer);
        btnBack.style.display = 'inline-block';
        btnBack.textContent = 'Retour aux sujets';
        btnBack.onclick = showTopicMenu;
    }

    function showMagicStory(storyIndex) {
        content.innerHTML = '';
        const story = magicStories[storyIndex];
        const storyContainer = document.createElement('div');
        storyContainer.className = 'story-container fx-bounce-in-down';
        storyContainer.innerHTML = `<h2>${story.title}</h2><img src="${story.image}" alt="${story.title}" />`;
        
        story.text.forEach(paragraph => {
            const p = document.createElement('p');
            p.textContent = paragraph;
            storyContainer.appendChild(p);
        });
        
        for(let i = 0; i < 5; i++) {
          const sparkle = document.createElement('span');
          sparkle.className = 'sparkle';
          sparkle.textContent = '‚ú®';
          sparkle.style.top = `${Math.random() * 100}%`;
          sparkle.style.left = `${Math.random() * 100}%`;
          sparkle.style.animationDelay = `${Math.random() * 2}s`;
          storyContainer.appendChild(sparkle);
        }

        const startQuizBtn = document.createElement('button');
        startQuizBtn.className = 'btn submit-btn fx-bounce-in-down';
        startQuizBtn.textContent = 'Commencer le quiz';
        startQuizBtn.style.marginTop = '2rem';
        startQuizBtn.addEventListener('click', () => startStoryQuiz(story.quiz));
        
        content.appendChild(storyContainer);
        content.appendChild(startQuizBtn);
        
        btnBack.style.display = 'inline-block';
        btnBack.textContent = 'Retour aux contes';
        btnBack.onclick = showStoryMenu;
        
        const fullStoryText = story.text.join(' ');
        speakText(story.title + '. ' + fullStoryText);
    }
    
    function startStoryQuiz(quizQuestions) {
        storyQuiz = quizQuestions;
        currentQuestionIndex = 0;
        loadQuizQuestion();
    }
    
    function loadQuizQuestion() {
        if (currentQuestionIndex >= storyQuiz.length) {
            showQuizResults();
            return;
        }
        
        content.innerHTML = '';
        const questionData = storyQuiz[currentQuestionIndex];
        const fragment = document.createDocumentFragment();
        
        const title = document.createElement('div');
        title.className = 'question-prompt fx-bounce-in-down';
        title.innerHTML = `Question ${currentQuestionIndex + 1}:<br>${questionData.question}`;
        fragment.appendChild(title);
        speakText(questionData.question);
        
        const optionsContainer = document.createElement('div');
        optionsContainer.className = 'options-grid';
        
        const shuffledOptions = shuffle([...questionData.options]);
        shuffledOptions.forEach((opt, i) => {
            const optionEl = document.createElement('button');
            optionEl.className = 'option fx-bounce-in-down';
            optionEl.style.animationDelay = `${i * 0.1 + 0.5}s`;
            optionEl.innerHTML = opt;
            const originalIndex = questionData.options.indexOf(opt);
            optionEl.dataset.index = originalIndex;
            optionEl.addEventListener('click', handleStoryQuizAnswer);
            optionsContainer.appendChild(optionEl);
        });
        fragment.appendChild(optionsContainer);
        content.appendChild(fragment);

        btnBack.textContent = 'Retour au menu des contes';
        btnBack.onclick = showStoryMenu;
    }
    
    function handleStoryQuizAnswer(event) {
        const selected = event.target;
        const options = document.querySelectorAll('.option');
        options.forEach(opt => opt.removeEventListener('click', handleStoryQuizAnswer));
        
        const questionData = storyQuiz[currentQuestionIndex];
        const userAnswerIndex = parseInt(selected.dataset.index, 10);
        const correctAnswerIndex = questionData.correct;
        const correctValue = questionData.options[correctAnswerIndex];

        if (userAnswerIndex === correctAnswerIndex) {
            selected.classList.add('correct');
            userScore.stars += 15;
            userScore.coins += 10;
            showSuccessMessage('Bonne r√©ponse !');
            showConfetti();
        } else {
            selected.classList.add('wrong');
            userScore.coins = Math.max(0, userScore.coins - 5);
            const correctOption = document.querySelector(`.option[data-index="${correctAnswerIndex}"]`);
            if (correctOption) {
                correctOption.classList.add('correct');
            }
            showErrorMessage('Mauvaise r√©ponse.', correctValue);
        }
        updateUI();
        
        setTimeout(() => {
            currentQuestionIndex++;
            loadQuizQuestion();
        }, 2000);
    }
    
    function showQuizResults() {
        content.innerHTML = `
            <div class="prompt ok fx-pop">
                Quiz termin√© ! üéâ
                <p>Tu as gagn√© des √©toiles et des pi√®ces !</p>
            </div>
            <button class="btn submit-btn fx-bounce-in-down" onclick="showStoryMenu()">Retourner aux contes</button>
        `;
        speakText('Quiz termin√© ! Bravo !');
        btnBack.textContent = 'Retourner au Menu Principal';
        btnBack.onclick = showTopicMenu;
    }


    function showMemoryGameMenu() {
      content.innerHTML = `
        <div class="question-prompt fx-bounce-in-down">
          Choisis un niveau de m√©moire
        </div>
        <div class="options-grid">
          ${MEMORY_GAME_LEVELS.map(level => `
            <button class="topic-btn fx-bounce-in-down" onclick="showMemoryGame(${level.pairs})" style="animation-delay: ${Math.random() * 0.5}s;">
              Niveau ${level.level}<br>
              ${level.pairs} paires
            </button>
          `).join('')}
        </div>
      `;
      btnBack.style.display = 'inline-block';
      btnBack.textContent = 'Retour aux sujets';
      btnBack.onclick = showTopicMenu;
    }

    function showMemoryGame(pairsCount) {
        content.innerHTML = '';
        const title = document.createElement('div');
        title.className = 'question-prompt fx-bounce-in-down';
        title.textContent = 'Trouve toutes les paires !';
        content.appendChild(title);
        speakText('Trouve toutes les paires !');

        const memoryGrid = document.createElement('div');
        memoryGrid.className = 'memory-grid';
        const levelConfig = MEMORY_GAME_LEVELS.find(l => l.pairs === pairsCount);
        if (levelConfig) {
          const gridSize = Math.sqrt(pairsCount * 2);
          memoryGrid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
        }
        content.appendChild(memoryGrid);

        const cardEmojis = Object.values(emoji).slice(6, 6 + pairsCount);
        const gameCards = shuffle([...cardEmojis, ...cardEmojis]);
        let flippedCards = [];
        let matchedPairs = 0;
        let lockBoard = false;

        gameCards.forEach((emoji, index) => {
            const card = document.createElement('div');
            card.className = 'memory-card fx-bounce-in-down';
            card.style.animationDelay = `${index * 0.05}s`;
            card.innerHTML = `<span style="opacity:0;">${emoji}</span>`;
            card.addEventListener('click', () => flipCard(card, emoji, index));
            memoryGrid.appendChild(card);
        });

        function flipCard(card, emoji, index) {
            if (lockBoard) return;
            if (card.classList.contains('flipped')) return;

            card.classList.add('flipped');
            card.querySelector('span').style.opacity = '1';
            flippedCards.push({ card, emoji, index });

            if (flippedCards.length === 2) {
                lockBoard = true;
                const [card1, card2] = flippedCards;
                if (card1.emoji === card2.emoji) {
                    card1.card.classList.add('matched');
                    card2.card.classList.add('matched');
                    matchedPairs++;
                    userScore.stars += 20;
                    userScore.coins += 10;
                    playSound('correct');
                    updateUI();
                    flippedCards = [];
                    lockBoard = false;
                    if (matchedPairs === pairsCount) {
                        showSuccessMessage('ü¶Ñ Toutes les paires trouv√©es !');
                        showConfetti();
                        setTimeout(showMemoryGameMenu, 2000);
                    }
                } else {
                    setTimeout(() => {
                        card1.card.classList.remove('flipped');
                        card2.card.classList.remove('flipped');
                        card1.card.querySelector('span').style.opacity = '0';
                        card2.card.querySelector('span').style.opacity = '0';
                        flippedCards = [];
                        lockBoard = false;
                        userScore.coins = Math.max(0, userScore.coins - 5);
                        playSound('wrong');
                        updateUI();
                        showErrorMessage('Mauvaise r√©ponse.', `Il fallait trouver une paire de ${card1.emoji}`);
                    }, 1000);
                }
            }
        }
        btnBack.style.display = 'inline-block';
        btnBack.textContent = 'Retour aux niveaux de m√©moire';
        btnBack.onclick = showMemoryGameMenu;
    }
    
    /**
     * Muestra el juego de ordenar.
     * @param {number} level El nivel de dificultad.
     */
    function showSortingGame(level) {
        currentLevel = level;
        content.innerHTML = '';
        updateUI();

        const container = document.createElement('div');
        container.className = 'sorting-container fx-bounce-in-down';

        const instruction = document.createElement('p');
        instruction.className = 'question-prompt';
        container.appendChild(instruction);
        
        const listContainer = document.createElement('div');
        listContainer.className = 'sorting-list';
        container.appendChild(listContainer);
        
        const checkBtn = document.createElement('button');
        checkBtn.className = 'submit-btn fx-bounce-in-down';
        checkBtn.textContent = 'V√©rifier';
        container.appendChild(checkBtn);
        
        content.appendChild(container);
        
        let items, sortedItems;
        if (level === 1) { // N√∫meros
            items = shuffle([5, 2, 8, 1, 6]);
            sortedItems = items.slice().sort((a, b) => a - b);
            instruction.textContent = "Trie ces nombres du plus petit au plus grand.";
        } else if (level === 2) { // Colores
            items = shuffle(['üî¥', 'üîµ', 'üü¢', 'üü°', 'üü£']);
            sortedItems = ['üî¥', 'üîµ', 'üü¢', 'üü°', 'üü£'];
            instruction.textContent = "Trie ces couleurs dans l'ordre de l'arc-en-ciel.";
        } else if (level === 3) { // Animales
             items = shuffle(['üê∂', 'üê±', 'üê∞', 'üêª', 'üêº']);
             sortedItems = ['üê∂', 'üê±', 'üê∞', 'üêª', 'üêº'];
             instruction.textContent = "Trie ces animaux.";
        } else if (level === 4) { // Numeros romanos
            items = shuffle(['I', 'V', 'X', 'L', 'C']);
            sortedItems = ['I', 'V', 'X', 'L', 'C'];
            instruction.textContent = "Trie ces nombres romains du plus petit au plus grand.";
        } else if (level === 5) { // D√≠as de la semana
            items = shuffle(['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi']);
            sortedItems = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi'];
            instruction.textContent = "Trie ces jours de la semaine.";
        } else if (level === 6) { // Meses del a√±o
            items = shuffle(['Janvier', 'F√©vrier', 'Mars', 'Avril']);
            sortedItems = ['Janvier', 'F√©vrier', 'Mars', 'Avril'];
            instruction.textContent = "Trie ces mois dans l'ordre de l'ann√©e.";
        } else if (level === 7) { // Letras
            items = shuffle(['d', 'c', 'b', 'a']);
            sortedItems = ['a', 'b', 'c', 'd'];
            instruction.textContent = "Trie ces lettres dans l'ordre alphab√©tique.";
        } else if (level === 8) { // Frutas
            items = shuffle(['üçé', 'üçå', 'üçá', 'üçä']);
            sortedItems = ['üçé', 'üçå', 'üçá', 'üçä'];
            instruction.textContent = "Trie ces fruits par ordre de couleur (rouge, jaune, violet, orange).";
        } else if (level === 9) { // Tamano
            items = shuffle(['petit', 'moyen', 'grand', '√©norme']);
            sortedItems = ['petit', 'moyen', 'grand', '√©norme'];
            instruction.textContent = "Trie ces mots du plus petit au plus grand.";
        } else { // Sumas
            items = shuffle(['5+2', '1+3', '4+1', '3+3']);
            sortedItems = ['1+3', '4+1', '3+3', '5+2'];
            instruction.textContent = "Trie ces additions par ordre de r√©sultat croissant.";
        }
        
        speakText(instruction.textContent);

        let draggedItem = null;

        items.forEach(item => {
            const el = document.createElement('div');
            el.className = 'sortable-item';
            el.textContent = item;
            el.draggable = true;
            listContainer.appendChild(el);
            
            el.addEventListener('dragstart', () => {
                draggedItem = el;
                setTimeout(() => el.classList.add('dragging'), 0);
            });
            
            el.addEventListener('dragend', () => {
                draggedItem.classList.remove('dragging');
                draggedItem = null;
            });
        });

        listContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            const afterElement = getDragAfterElement(listContainer, e.clientX);
            if (afterElement == null) {
                listContainer.appendChild(draggedItem);
            } else {
                listContainer.insertBefore(draggedItem, afterElement);
            }
        });

        function getDragAfterElement(container, x) {
            const draggableElements = [...container.querySelectorAll('.sortable-item:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = x - box.left - box.width / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        checkBtn.addEventListener('click', () => {
            const userOrder = [...listContainer.children].map(el => el.textContent);
            const isCorrect = userOrder.every((item, index) => item == sortedItems[index]);
            
            if (isCorrect) {
                userScore.stars += 30;
                userScore.coins += 20;
                showSuccessMessage('C\'est bien tri√© ! üéâ');
                showConfetti();
                checkBtn.textContent = "Niveau suivant";
                checkBtn.onclick = () => {
                    if (currentLevel < 10) showSortingGame(currentLevel + 1);
                    else showLevelMenu(currentTopic);
                };
            } else {
                userScore.coins = Math.max(0, userScore.coins - 5);
                showErrorMessage('Ce n\'est pas le bon ordre.', `La bonne r√©ponse √©tait: ${sortedItems.join(', ')}`);
            }
            updateUI();
        });

        btnBack.style.display = 'inline-block';
        btnBack.textContent = 'Retour aux niveaux';
        btnBack.onclick = () => showLevelMenu(currentTopic);
    }
    
    /**
     * Muestra el juego de adivinanzas.
     */
    function showRiddleGame() {
        currentTopic = 'riddles';
        showLevelMenu(currentTopic);
    }
    
    function loadRiddleQuestion(index) {
        if (index >= riddles.length) {
            win();
            return;
        }
        
        currentQuestionIndex = index;
        content.innerHTML = '';
        updateUI();
        
        const riddleData = riddles[currentQuestionIndex];
        const fragment = document.createDocumentFragment();
        
        const title = document.createElement('div');
        title.className = 'question-prompt fx-bounce-in-down';
        title.innerHTML = riddleData.riddle;
        fragment.appendChild(title);
        speakText(riddleData.riddle);

        const optionsContainer = document.createElement('div');
        optionsContainer.className = 'options-grid';
        
        const shuffledOptions = shuffle([...riddleData.options]);
        shuffledOptions.forEach((opt, i) => {
            const optionEl = document.createElement('button');
            optionEl.className = 'option fx-bounce-in-down';
            optionEl.style.animationDelay = `${i * 0.1 + 0.5}s`;
            optionEl.innerHTML = opt;
            const originalIndex = riddleData.options.indexOf(opt);
            optionEl.dataset.index = originalIndex;
            optionEl.addEventListener('click', handleRiddleAnswer);
            optionsContainer.appendChild(optionEl);
        });
        fragment.appendChild(optionsContainer);
        content.appendChild(fragment);

        btnBack.style.display = 'inline-block';
        btnBack.textContent = 'Retour aux niveaux';
        btnBack.onclick = () => showLevelMenu(currentTopic);
    }
    
    function handleRiddleAnswer(event) {
        const selected = event.target;
        const options = document.querySelectorAll('.option');
        options.forEach(opt => opt.removeEventListener('click', handleRiddleAnswer));
        
        const riddleData = riddles[currentQuestionIndex];
        const userAnswerIndex = parseInt(selected.dataset.index, 10);
        const correctAnswerIndex = riddleData.correct;
        const correctValue = riddleData.options[correctAnswerIndex];

        if (userAnswerIndex === correctAnswerIndex) {
            selected.classList.add('correct');
            userScore.stars += riddleData.reward.stars;
            userScore.coins += riddleData.reward.coins;
            showSuccessMessage('Bonne r√©ponse !');
            showConfetti();
        } else {
            selected.classList.add('wrong');
            userScore.coins = Math.max(0, userScore.coins - 5);
            const correctOption = document.querySelector(`[data-index="${correctAnswerIndex}"]`);
            if (correctOption) {
                correctOption.classList.add('correct');
            }
            showErrorMessage('Mauvaise r√©ponse.', correctValue);
        }
        updateUI();
        setTimeout(() => {
            currentQuestionIndex++;
            loadRiddleQuestion(currentQuestionIndex);
        }, 2000);
    }
    
    // --- NOUVEAUX JEUX ---

    function showVowelGame() {
        currentTopic = 'vowels';
        showLevelMenu(currentTopic);
    }
    
    function loadVowelQuestion(index) {
        if (index >= words.length) {
            win();
            return;
        }

        currentQuestionIndex = index;
        content.innerHTML = '';
        updateUI();

        const wordData = words[index];
        const word = wordData.word;
        const vowels = ['a', 'e', 'i', 'o', 'u'];
        const correctVowel = vowels.find(v => word.includes(v));
        const blankedWord = word.replace(correctVowel, '<span class="blank"></span>');
        
        const title = document.createElement('div');
        title.className = 'question-prompt fx-bounce-in-down';
        title.innerHTML = `Quelle voyelle manque ? <div class="word-with-blank">${blankedWord}</div>`;
        content.appendChild(title);
        
        const imageContainer = document.createElement('div');
        imageContainer.className = 'image-container fx-bounce-in-down';
        imageContainer.innerHTML = `<img src="${wordData.image}" alt="${word}" />`;
        content.appendChild(imageContainer);

        const optionsContainer = document.createElement('div');
        optionsContainer.className = 'options-grid';
        
        const options = shuffle([...vowels.filter(v => v !== correctVowel).slice(0, 3), correctVowel]);
        options.forEach(opt => {
            const optionEl = document.createElement('button');
            optionEl.className = 'option fx-bounce-in-down';
            optionEl.textContent = opt.toUpperCase();
            optionEl.dataset.vowel = opt;
            optionEl.addEventListener('click', handleVowelAnswer);
            optionsContainer.appendChild(optionEl);
        });
        content.appendChild(optionsContainer);
        speakText(`Quelle voyelle manque ? ${wordData.hint}`);

        btnBack.style.display = 'inline-block';
        btnBack.textContent = 'Retour aux niveaux';
        btnBack.onclick = () => showLevelMenu(currentTopic);
    }

    function handleVowelAnswer(event) {
        const selected = event.target;
        const options = document.querySelectorAll('.option');
        options.forEach(opt => opt.removeEventListener('click', handleVowelAnswer));

        const wordData = words[currentQuestionIndex];
        const word = wordData.word;
        const vowels = ['a', 'e', 'i', 'o', 'u'];
        const correctVowel = vowels.find(v => word.includes(v));
        const userAnswer = selected.dataset.vowel;
        
        if (userAnswer === correctVowel) {
            selected.classList.add('correct');
            userScore.stars += 10;
            userScore.coins += 5;
            showSuccessMessage('C\'est la bonne voyelle !');
            showConfetti();
        } else {
            selected.classList.add('wrong');
            userScore.coins = Math.max(0, userScore.coins - 5);
            const correctOption = document.querySelector(`[data-vowel="${correctVowel}"]`);
            if (correctOption) {
                correctOption.classList.add('correct');
            }
            showErrorMessage('Mauvaise r√©ponse.', correctVowel.toUpperCase());
        }
        updateUI();

        setTimeout(() => {
            loadVowelQuestion(currentQuestionIndex + 1);
        }, 2000);
    }

    function showSequenceGame() {
        currentTopic = 'sequences';
        showLevelMenu(currentTopic);
    }

    function loadSequenceQuestion(index) {
        if (index >= sequences.length) {
            win();
            return;
        }

        currentQuestionIndex = index;
        content.innerHTML = '';
        updateUI();

        const questionData = sequences[index];
        const title = document.createElement('div');
        title.className = 'question-prompt fx-bounce-in-down';
        title.textContent = 'Quel est le prochain √©l√©ment de la s√©quence ?';
        content.appendChild(title);

        const sequenceContainer = document.createElement('div');
        sequenceContainer.className = 'sequence-container fx-bounce-in-down';
        questionData.items.forEach(item => {
            const itemEl = document.createElement('span');
            itemEl.className = 'sequence-item';
            itemEl.textContent = item;
            sequenceContainer.appendChild(itemEl);
        });
        content.appendChild(sequenceContainer);

        const optionsContainer = document.createElement('div');
        optionsContainer.className = 'options-grid';
        
        const shuffledOptions = shuffle([...questionData.options]);
        shuffledOptions.forEach(opt => {
            const optionEl = document.createElement('button');
            optionEl.className = 'option fx-bounce-in-down';
            optionEl.textContent = opt;
            optionEl.dataset.value = opt;
            optionEl.addEventListener('click', handleSequenceAnswer);
            optionsContainer.appendChild(optionEl);
        });
        content.appendChild(optionsContainer);
        speakText('Quel est le prochain √©l√©ment de la s√©quence ?');

        btnBack.style.display = 'inline-block';
        btnBack.textContent = 'Retour aux niveaux';
        btnBack.onclick = () => showLevelMenu(currentTopic);
    }
    
    function handleSequenceAnswer(event) {
        const selected = event.target;
        const options = document.querySelectorAll('.option');
        options.forEach(opt => opt.removeEventListener('click', handleSequenceAnswer));
        
        const questionData = sequences[currentQuestionIndex];
        const userAnswer = selected.dataset.value;
        const correctValue = questionData.correct;

        if (userAnswer === correctValue) {
            selected.classList.add('correct');
            userScore.stars += 15;
            userScore.coins += 10;
            showSuccessMessage('Tu as trouv√© le bon ordre !');
            showConfetti();
        } else {
            selected.classList.add('wrong');
            userScore.coins = Math.max(0, userScore.coins - 5);
            const correctOption = document.querySelector(`[data-value="${correctValue}"]`);
            if (correctOption) {
                correctOption.classList.add('correct');
            }
            showErrorMessage('Mauvaise r√©ponse.', correctValue);
        }
        updateUI();

        setTimeout(() => {
            loadSequenceQuestion(currentQuestionIndex + 1);
        }, 2000);
    }

    function win() {
        content.innerHTML = `<div class="question-prompt fx-pop">Tu as compl√©t√© toutes les questions! üéâ</div>
                            <div class="prompt ok">Ton score final : ${userScore.stars} √©toiles et ${userScore.coins} pi√®ces.</div>`;
        speakText("Tu as compl√©t√© toutes les questions! F√©licitations pour ton score final.");
        btnBack.style.display = 'inline-block';
        btnBack.textContent = 'Retourner au Menu Principal';
        btnBack.onclick = showTopicMenu;
    }

    // Inicio del juego
    document.addEventListener('DOMContentLoaded', () => {
        initializeQuestions();
        showTopicMenu();
        btnBack.addEventListener('click', showTopicMenu);
    });
  </script>
</body>
</html>
